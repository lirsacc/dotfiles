#!/usr/bin/env bash

if [[ -z $(command -v brew) ]]; then
    echo "Homebrew is needed here, please install from https://brew.sh..."
    return 1
fi

SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

export HOMEBREW_NO_AUTO_UPDATE=1
export HOMEBREW_BUILD_FROM_SOURCE=0
export HOMEBREW_NO_EMOJI=1
export HOMEBREW_NO_ANALYTICS=1

# Make sure weâ€™re using the latest Homebrew
brew update

brew doctor

echo -n "Upgrade all already-installed formulae? (y/n) "
read -rp "" -n 1
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo
    brew upgrade
fi

brew bundle --file="$SCRIPT_DIR/../Brewfile"

# Remove outdated versions from the cellar
brew cleanup
